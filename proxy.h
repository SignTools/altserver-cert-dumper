#include <Windows.h>

#define WRAPPER_GENFUNC(name) \
    FARPROC orig_##name; \
    __declspec(naked) void _##name() \
    { \
        asm("jmp *_orig_"#name); \
    }

WRAPPER_GENFUNC(adler32)
WRAPPER_GENFUNC(adler32_combine)
WRAPPER_GENFUNC(adler32_z)
WRAPPER_GENFUNC(compress)
WRAPPER_GENFUNC(compress2)
WRAPPER_GENFUNC(compressBound)
WRAPPER_GENFUNC(crc32)
WRAPPER_GENFUNC(crc32_combine)
WRAPPER_GENFUNC(crc32_z)
WRAPPER_GENFUNC(deflate)
WRAPPER_GENFUNC(deflateBound)
WRAPPER_GENFUNC(deflateCopy)
WRAPPER_GENFUNC(deflateEnd)
WRAPPER_GENFUNC(deflateGetDictionary)
WRAPPER_GENFUNC(deflateInit2_)
WRAPPER_GENFUNC(deflateInit_)
WRAPPER_GENFUNC(deflateParams)
WRAPPER_GENFUNC(deflatePending)
WRAPPER_GENFUNC(deflatePrime)
WRAPPER_GENFUNC(deflateReset)
WRAPPER_GENFUNC(deflateResetKeep)
WRAPPER_GENFUNC(deflateSetDictionary)
WRAPPER_GENFUNC(deflateSetHeader)
WRAPPER_GENFUNC(deflateTune)
WRAPPER_GENFUNC(get_crc_table)
WRAPPER_GENFUNC(gzbuffer)
WRAPPER_GENFUNC(gzclearerr)
WRAPPER_GENFUNC(gzclose)
WRAPPER_GENFUNC(gzclose_r)
WRAPPER_GENFUNC(gzclose_w)
WRAPPER_GENFUNC(gzdirect)
WRAPPER_GENFUNC(gzdopen)
WRAPPER_GENFUNC(gzeof)
WRAPPER_GENFUNC(gzerror)
WRAPPER_GENFUNC(gzflush)
WRAPPER_GENFUNC(gzfread)
WRAPPER_GENFUNC(gzfwrite)
WRAPPER_GENFUNC(gzgetc)
WRAPPER_GENFUNC(gzgetc_)
WRAPPER_GENFUNC(gzgets)
WRAPPER_GENFUNC(gzoffset)
WRAPPER_GENFUNC(gzoffset64)
WRAPPER_GENFUNC(gzopen)
WRAPPER_GENFUNC(gzopen64)
WRAPPER_GENFUNC(gzopen_w)
WRAPPER_GENFUNC(gzprintf)
WRAPPER_GENFUNC(gzputc)
WRAPPER_GENFUNC(gzputs)
WRAPPER_GENFUNC(gzread)
WRAPPER_GENFUNC(gzrewind)
WRAPPER_GENFUNC(gzseek)
WRAPPER_GENFUNC(gzseek64)
WRAPPER_GENFUNC(gzsetparams)
WRAPPER_GENFUNC(gztell)
WRAPPER_GENFUNC(gztell64)
WRAPPER_GENFUNC(gzungetc)
WRAPPER_GENFUNC(gzvprintf)
WRAPPER_GENFUNC(gzwrite)
WRAPPER_GENFUNC(inflate)
WRAPPER_GENFUNC(inflateBack)
WRAPPER_GENFUNC(inflateBackEnd)
WRAPPER_GENFUNC(inflateBackInit_)
WRAPPER_GENFUNC(inflateCodesUsed)
WRAPPER_GENFUNC(inflateCopy)
WRAPPER_GENFUNC(inflateEnd)
WRAPPER_GENFUNC(inflateGetDictionary)
WRAPPER_GENFUNC(inflateGetHeader)
WRAPPER_GENFUNC(inflateInit2_)
WRAPPER_GENFUNC(inflateInit_)
WRAPPER_GENFUNC(inflateMark)
WRAPPER_GENFUNC(inflatePrime)
WRAPPER_GENFUNC(inflateReset)
WRAPPER_GENFUNC(inflateReset2)
WRAPPER_GENFUNC(inflateResetKeep)
WRAPPER_GENFUNC(inflateSetDictionary)
WRAPPER_GENFUNC(inflateSync)
WRAPPER_GENFUNC(inflateSyncPoint)
WRAPPER_GENFUNC(inflateUndermine)
WRAPPER_GENFUNC(inflateValidate)
WRAPPER_GENFUNC(uncompress)
WRAPPER_GENFUNC(uncompress2)
WRAPPER_GENFUNC(zError)
WRAPPER_GENFUNC(zlibCompileFlags)
WRAPPER_GENFUNC(zlibVersion)

#define WRAPPER_FUNC(name) orig_##name = GetProcAddress(hOriginalDll, #name);

void SourceInit() {
	HMODULE hOriginalDll = LoadLibrary("zlib2.dll");

	WRAPPER_FUNC(adler32)
	WRAPPER_FUNC(adler32_combine)
	WRAPPER_FUNC(adler32_z)
	WRAPPER_FUNC(compress)
	WRAPPER_FUNC(compress2)
	WRAPPER_FUNC(compressBound)
	WRAPPER_FUNC(crc32)
	WRAPPER_FUNC(crc32_combine)
	WRAPPER_FUNC(crc32_z)
	WRAPPER_FUNC(deflate)
	WRAPPER_FUNC(deflateBound)
	WRAPPER_FUNC(deflateCopy)
	WRAPPER_FUNC(deflateEnd)
	WRAPPER_FUNC(deflateGetDictionary)
	WRAPPER_FUNC(deflateInit2_)
	WRAPPER_FUNC(deflateInit_)
	WRAPPER_FUNC(deflateParams)
	WRAPPER_FUNC(deflatePending)
	WRAPPER_FUNC(deflatePrime)
	WRAPPER_FUNC(deflateReset)
	WRAPPER_FUNC(deflateResetKeep)
	WRAPPER_FUNC(deflateSetDictionary)
	WRAPPER_FUNC(deflateSetHeader)
	WRAPPER_FUNC(deflateTune)
	WRAPPER_FUNC(get_crc_table)
	WRAPPER_FUNC(gzbuffer)
	WRAPPER_FUNC(gzclearerr)
	WRAPPER_FUNC(gzclose)
	WRAPPER_FUNC(gzclose_r)
	WRAPPER_FUNC(gzclose_w)
	WRAPPER_FUNC(gzdirect)
	WRAPPER_FUNC(gzdopen)
	WRAPPER_FUNC(gzeof)
	WRAPPER_FUNC(gzerror)
	WRAPPER_FUNC(gzflush)
	WRAPPER_FUNC(gzfread)
	WRAPPER_FUNC(gzfwrite)
	WRAPPER_FUNC(gzgetc)
	WRAPPER_FUNC(gzgetc_)
	WRAPPER_FUNC(gzgets)
	WRAPPER_FUNC(gzoffset)
	WRAPPER_FUNC(gzoffset64)
	WRAPPER_FUNC(gzopen)
	WRAPPER_FUNC(gzopen64)
	WRAPPER_FUNC(gzopen_w)
	WRAPPER_FUNC(gzprintf)
	WRAPPER_FUNC(gzputc)
	WRAPPER_FUNC(gzputs)
	WRAPPER_FUNC(gzread)
	WRAPPER_FUNC(gzrewind)
	WRAPPER_FUNC(gzseek)
	WRAPPER_FUNC(gzseek64)
	WRAPPER_FUNC(gzsetparams)
	WRAPPER_FUNC(gztell)
	WRAPPER_FUNC(gztell64)
	WRAPPER_FUNC(gzungetc)
	WRAPPER_FUNC(gzvprintf)
	WRAPPER_FUNC(gzwrite)
	WRAPPER_FUNC(inflate)
	WRAPPER_FUNC(inflateBack)
	WRAPPER_FUNC(inflateBackEnd)
	WRAPPER_FUNC(inflateBackInit_)
	WRAPPER_FUNC(inflateCodesUsed)
	WRAPPER_FUNC(inflateCopy)
	WRAPPER_FUNC(inflateEnd)
	WRAPPER_FUNC(inflateGetDictionary)
	WRAPPER_FUNC(inflateGetHeader)
	WRAPPER_FUNC(inflateInit2_)
	WRAPPER_FUNC(inflateInit_)
	WRAPPER_FUNC(inflateMark)
	WRAPPER_FUNC(inflatePrime)
	WRAPPER_FUNC(inflateReset)
	WRAPPER_FUNC(inflateReset2)
	WRAPPER_FUNC(inflateResetKeep)
	WRAPPER_FUNC(inflateSetDictionary)
	WRAPPER_FUNC(inflateSync)
	WRAPPER_FUNC(inflateSyncPoint)
	WRAPPER_FUNC(inflateUndermine)
	WRAPPER_FUNC(inflateValidate)
	WRAPPER_FUNC(uncompress)
	WRAPPER_FUNC(uncompress2)
	WRAPPER_FUNC(zError)
	WRAPPER_FUNC(zlibCompileFlags)
	WRAPPER_FUNC(zlibVersion)
}
